# DO NOT MODIFY: Auto-generated by the gen_installer.py script from the .github/workflows/test.yml Github Action

export BUILD_TYPE='Release'
export SDL_VERSION='release-2.30.10'
export OPENCV_VERSION='4.10.0'
export CATCH_VERSION='v3.7.1'
export SPDLOG_VERSION='v1.15.0'
export EXIV2_VERSION='v0.28.3'
export GENERATOR='Ninja Multi-Config'

git submodule update --init
#brew install sdl2 spdlog catch2


git clone https://github.com/opencv/opencv.git --depth 1 --branch $OPENCV_VERSION
cd opencv
cmake -B build \
  -DCMAKE_BUILD_TYPE=$BUILD_TYPE \
  -DCMAKE_INSTALL_PREFIX=install \
  `cat ../misc/build/opencv-minimal-flags.txt`
cmake --build build --target install -j `sysctl -n hw.logicalcpu`
cd ..


git clone https://github.com/Exiv2/exiv2.git --depth 1 --branch $EXIV2_VERSION
cd exiv2
cmake -B build \
  -DCMAKE_INSTALL_PREFIX=install \
  `cat ../misc/build/exiv2-minimal-flags.txt`
cmake --build build --target install -j `sysctl -n hw.logicalcpu`
cd ..

cmake -B build \
  -DCMAKE_BUILD_TYPE=$BUILD_TYPE \
  -DCMAKE_INSTALL_PREFIX=install \
  -DBUILD_TESTING=ON \
  -DCMAKE_EXPORT_COMPILE_COMMANDS=ON \
  -DOpenCV_ROOT=opencv/install \
  -Dexiv2_ROOT=exiv2/install

cmake --build build -j `sysctl -n hw.logicalcpu` --target install
cd build
ctest --output-on-failure
cd ..

./misc/build/macos/bundle.sh
ls -R Xpano.app
