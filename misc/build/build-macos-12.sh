# DO NOT MODIFY: Auto-generated by the gen_installer.py script from the .github/workflows/macos.yml Github Action

export BUILD_TYPE='Release'
export OPENCV_VERSION='4.7.0'

git submodule update --init
brew install sdl2 spdlog catch2


git clone https://github.com/opencv/opencv.git --depth 1 --branch $OPENCV_VERSION
cd opencv
cmake -B build \
  -DCMAKE_BUILD_TYPE=$BUILD_TYPE \
  -DCMAKE_INSTALL_PREFIX=install \
  `cat ../misc/build/opencv_minimal_flags.txt`
cmake --build build --target install -j $(nproc)
cd ..

cmake -B build \
  -DCMAKE_BUILD_TYPE=$BUILD_TYPE \
  -DCMAKE_INSTALL_PREFIX=install \
  -DBUILD_TESTING=ON \
  -DCMAKE_EXPORT_COMPILE_COMMANDS=ON \
  -DOpenCV_DIR=opencv/install/lib/cmake/opencv4

cmake --build build -j $(nproc) --target install
cd build
ctest
cd ..
